# zGameServer

一个基于Go语言开发的MMO游戏服务器框架，采用模块化设计，具有良好的可扩展性和性能。

## 项目特点

- **模块化设计**：清晰的代码结构，便于维护和扩展
- **多数据库支持**：支持连接多个MySQL数据库（账号、游戏、日志）
- **异步数据库操作**：所有数据库操作均为异步，提高服务器性能
- **配置化管理**：通过配置文件管理服务器参数和数据库连接
- **完善的日志系统**：使用zap日志框架，支持不同级别日志输出
- **协议缓冲区**：使用Protocol Buffers进行高效的网络通信
- **安全机制**：账号密码验证、角色数据保护
- **崩溃恢复**：服务器崩溃时自动捕获堆栈信息并记录到日志

## 技术栈

- **语言**：Go 1.25.5
- **网络**：TCP协议，Protocol Buffers
- **数据库**：MySQL
- **日志**：zap日志框架
- **配置**：ini配置文件
- **依赖管理**：Go Modules

## 项目结构

```
zGameServer/
├── bin/                    # 可执行文件目录
├── client/                 # 客户端测试代码
├── config/                 # 配置管理
├── db/                     # 数据库相关代码
│   ├── connector/          # 数据库连接
│   ├── dao/                # 数据访问对象
│   ├── models/             # 数据模型
│   └── db.go               # 数据库管理器
├── game/                   # 游戏核心逻辑
│   ├── global/             # 全局系统（拍卖、公会、地图）
│   └── player/             # 玩家系统（装备、背包、技能、任务）
├── gameserver/             # 服务器核心
├── handler/                # 请求处理器
├── logs/                   # 日志文件
├── protocol/               # 协议定义
├── protolayer/             # 协议层实现
├── router/                 # 路由管理
├── service/                # 服务实现
├── config.ini              # 配置文件
├── go.mod                  # Go模块依赖
├── go.sum                  # 依赖校验
└── main.go                 # 主入口文件
```

## 核心功能模块

### 1. 网络服务
- TCP服务，处理客户端连接
- 数据包路由和处理
- 会话管理

### 2. 玩家系统
- 账号创建和登录
- 角色创建、删除和选择
- 装备系统
- 背包系统
- 技能系统
- 任务系统
- 邮箱系统

### 3. 游戏系统
- 公会系统
- 拍卖系统
- 地图系统

### 4. 数据库模块
- 多数据库连接管理
- 异步数据库操作
- 数据模型定义
- 数据访问对象（DAO）

### 5. 日志系统
- 服务器运行日志
- 登录登出日志
- 错误和崩溃日志

## 配置文件

配置文件采用ini格式，主要包括：

- 服务器基本配置（监听地址、端口、最大连接数等）
- 日志配置（级别、路径、文件大小等）
- 数据库配置（多数据库连接信息）

## 快速开始

### 1. 环境要求

- Go 1.25.5或更高版本
- MySQL 9.5或更高版本

### 2. 安装依赖

```bash
go mod tidy
```

### 3. 配置数据库

1. 创建三个数据库：
   - account：存储账号信息
   - game：存储游戏数据
   - log：存储日志信息

2. 在config.ini中配置数据库连接信息

### 4. 编译和运行

```bash
# 编译
go build -o bin/zGameServer.exe main.go

# 运行
./bin/zGameServer.exe
```

### 5. 客户端测试

```bash
go run client/testclient.go
```

## 开发指南

### 添加新功能模块

1. 在game/目录下创建新的功能模块
2. 实现相应的服务和处理器
3. 在main.go中注册新服务
4. 更新协议定义（protocol/game.proto）

### 数据库操作

1. 在db/models/中定义数据模型
2. 在db/dao/中实现数据访问方法
3. 使用异步方式调用数据库操作

## 测试

运行测试：

```bash
go test ./...
```

## 日志

日志文件默认保存在logs/目录下，包括：
- server.log：服务器运行日志
- log.log：其他日志信息

## 安全

- 账号密码加密存储
- 敏感数据传输加密
- 输入验证和参数检查
- 防止SQL注入和XSS攻击

## 性能优化

- 异步数据库操作
- 连接池管理
- 内存池使用
- 减少锁竞争

## 未来规划

- 支持更多游戏系统（副本、竞技场等）
- 分布式服务器支持
- 负载均衡
- 热更新功能
- 监控系统

## 贡献

欢迎提交Issue和Pull Request！

## 许可证

MIT License
